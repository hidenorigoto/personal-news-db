# 記事要約自動生成機能 設計ドキュメント

## 1. 機能概要

- 記事（ニュース等）を新規追加する際、本文コンテンツをOpenAI API（例: GPT-3.5/4）に送信し、1000文字程度の要約文を自動生成する。
- 生成された要約は記事データの一部としてDB等に保存する。

---

## 2. 仕様詳細

### 2.1 トリガー
- 記事追加API（POST /api/articles）で新規記事が投稿されたタイミングでのみ自動実行

### 2.2 入力
- 記事本文（title, content, など必要に応じて）
- 言語（日本語/英語など、必要に応じて）

### 2.3 OpenAI API呼び出し
- 利用モデル: GPT-3.5-turbo, GPT-4o, GPT-4-turbo など
- プロンプト例:
  ```
  以下のニュース記事を1000文字程度で、重要なポイントを網羅するように要約してください。
  ---
  {記事本文}
  ```
- APIキーは環境変数や設定ファイルで安全に管理

### 2.4 出力
- 要約文（string, 1000文字程度）
- 必要に応じて要約のトークン数やAPIレスポンスも保存

### 2.5 保存
- 記事レコードに「summary」カラムを追加し、要約文を格納

### 2.6 エラーハンドリング
- OpenAI API失敗時はリトライ、または「要約生成失敗」等のメッセージを保存
- API利用上限やネットワークエラー時の例外処理

### 2.7 テスト
- モックAPIを使ったユニットテスト
- 実際のAPIを使った結合テスト（必要に応じて）

---

## 3. 1000文字要約の特徴・コスト

- 1000文字 ≒ 約650トークン（日本語の場合）
- モデルごとの出力コスト（1記事あたり）
  - gpt-3.5-turbo: 約$0.001
  - gpt-4o:        約$0.01
  - gpt-4-turbo:   約$0.02
- 入力トークン（記事本文）も加算されるが、出力が主なコスト要因
- 1日100記事生成でもgpt-3.5-turboなら$0.10/日程度

---

## 4. 実装上の注意

- max_tokensパラメータを十分大きく設定（例: 800〜900）
- モデルによっては「1000文字以内」と明示しても多少前後するため、後処理で文字数制限をかけることも可能
- 長文要約はgpt-3.5-turboでも十分可能だが、品質重視ならgpt-4oも選択肢

---

## 5. 推奨仕様まとめ

- 要約文字数: 1000文字程度
- プロンプト: 「1000文字程度で、重要なポイントを網羅するように要約してください」
- モデル: gpt-3.5-turbo（コスト重視）またはgpt-4o（品質重視）
- max_tokens: 800〜900（日本語の場合）
- UI: 詳細ページや展開型UIでの表示を推奨 